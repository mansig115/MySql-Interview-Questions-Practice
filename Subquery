-- Subquery
   Select * from students;
   -- 1 Find students who scored more than the average marks of their own subject.
   Select s.student_id, s.name from students s join marks m on s.student_id = m.student_id
   where m.marks > (Select avg(m1.marks) from marks m1 where m1.subject = m.subject);
   
-- 2 Find students whose marks are the highest in their respective subject.
 Select s.student_id, s.name, m.subject from students s join marks m on s.student_id = m.student_id
   where m.marks = (Select max(m1.marks) from marks m1 where m1.subject = m.subject);
   
   
-- 3 Insert into students all distinct student_ids from the marks table who are not already present in the students table.
INSERT INTO students (student_id) SELECT DISTINCT m.student_id FROM marks m
WHERE NOT EXISTS (
    SELECT 1
    FROM students s
    WHERE s.student_id = m.student_id
);


-- 4 Insert students into the students table who have scored more than 80 in any subject.
INSERT INTO students(student_id)
SELECT DISTINCT m.student_id From marks m where m.marks > 80 AND Not EXISTS(Select 1 from students s where s.student_id = m.student_id);

-- 5 Update the city of students to 'Topper City' for students whose average marks are greater than 85.
Update students SET city = "Topper City" 
where student_id IN(Select student_id from marks group by student_id having avg(marks) > 85);

-- 6. Students Scoring Above Their Own Average
Select s.student_id, s.name, m.marks  from students s join marks m on s.student_id = m.student_id where m.marks > (Select avg(m1.marks) from Marks m1  where m1.student_id
 = m.student_id);


-- 7. Subjects with Above Overall Average Marks
Select subject from marks  group by subject HAVING avg(marks) > (Select avg(marks) from marks);

-- 8. Students Who Never Scored Below 60
Select  s.student_id, s.name from students s where not exists(select 1 from marks m where m.student_id = s.student_id and m.marks < 60);

-- 9. Students with Same Marks in Multiple Subjects
Select s.name, m.subject, m.marks from students s join marks m on s.student_id = m.student_id where (m.student_id, m.marks) 
IN (Select student_id, marks from marks group by student_id, marks having count(Distinct subject) > 1);


-- 10. Students Who Scored in All Subjects
Select s.student_id, s.name from students s join marks m on s.student_id = m.student_id GROUP BY s.student_id, s.name HAVING count(distinct m.subject) = (Select 
count(Distinct subject) From marks);
